# 代码说明

## 环境配置

所需环境在 `requirements.txt` 中定义。

## 数据

* 使用大赛提供的有标注数据（21160）和无标注数据（5280）。
* 未使用任何额外数据。

## 预训练模型 

* 未使用预训练模型


## 算法


### 整体思路

* 整体代码是在baseline上进行的修改。
* 特征工程：
1. 首先只使用了log和trace数据集
2. log中统计了时间戳以及时间差分后的描述性特征，和关键词统计，和对service分组后的组内时间差分的描述性统计
3. trace中统计了状态编码和时间戳，开始时间，结束时间和他们的时间差的一些描述性统计，和一些细节方面的统计，加上一些分组后的组内统计
* 模型训练：
1. 模型使用了lgb+ovr，进行5折的交叉训练
* 预测：
1. 使用训练的5个模型，将他们的预测结果做平均，即得到最后结果


### 网络结构
### 损失函数
* 使用机器学习包中的roc_auc_score，作为评分函数
### 数据扩增
* 无数据扩增

### 模型集成
* 使用了ovr+lgb
### 其他细节
* 该算法未对模型进行调参



* 采用了两类模型进行集成，参考了以下经典架构设计模型
  * 单流模型 VL-Bert架构 
  * 双流模型 ALBEF架构 

* 单流模型和双流模型在9：1的SKF验证中，在不需要预训练的前提下，线上A榜均可达到0.685左右的分数

* 预训练采用了MFM，ITM，MLM

* 主要模型思路（更有效且更快的模型融合）
1. 使用100w无标签数据对单流模型进行预训练（图像提取模型固定，提前采用swin_base_patch4_window7_224_22k.pth进行抽帧）；
2. 使用10w有标签数据对单流模型进行微调（图像提取模型放开）；
3. 加载单流模型训练好的swin_base部分的权重，抽取图像帧；
4. 使用10w有标签数据对双流模型进行微调（图像提取模型固定，第3步已抽取特征）；
5. 加载单流和双流模型训练权重，在推理时，以softmax输出进行0.55 ： 0.45 的权重进行融合。

注：单流模型和双流模型全量数据训练的最佳step通过9：1的SKF划分训练得到的结果进行确定最佳step训练的模型

模型优点：效率高。预训练只训练一次，且冻结了图像提取的backbone，使得预训练（包含抽帧）仅需24小时内即可完成，然后单流模型的训练需要12个小时，而双流模型（包含抽帧）仅需要1.5个小时、

* 采用APEX的FP16进行压缩模型，提升了一倍的效率(预训练不采用FP16，防止NAN），另外TensorRT也有实现，但我们的模型不够多，并没有采用更复杂的TensorRT进行推理

* 其他Trick仅采用了label smoothing。



### 性能


B榜融合测试性能：**0.705623**



## 训练流程

* sh init.sh

* sh train.sh
  

## 测试流程

* sh inference.sh即可

## 其他注意事项
* 无
